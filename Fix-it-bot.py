#!/usr/bin/env python3
import os
from pathlib import Path
import re

ROOT = Path(".")
IMAGE_DIR = ROOT / "images"

def fix_image_case():
    """Oprav√≠ img src tagy na spr√°vnou velikost p√≠smen podle skuteƒçn√Ωch soubor≈Ø."""
    if not IMAGE_DIR.exists():
        print("üñºÔ∏è  Slo≈æka 'images' neexistuje.")
        return

    # Vytvo≈ô mapov√°n√≠: lowercase n√°zev ‚Üí spr√°vn√Ω n√°zev
    real_files = {f.name.lower(): f.name for f in IMAGE_DIR.iterdir() if f.is_file()}

    fixed = 0
    for html_file in ROOT.rglob("*.html"):
        content = html_file.read_text(encoding="utf-8")
        new_content = content

        # Najdi v≈°echny img src
        pattern = r'<img\s+[^>]*src\s*=\s*["\']([^"\']+)["\'][^>]*>'
        matches = re.findall(pattern, content, re.IGNORECASE)

        for src in matches:
            if src.startswith("images/") and not src.startswith("http"):
                filename = src.split("/")[-1]
                lower_filename = filename.lower()
                if lower_filename in real_files and filename != real_files[lower_filename]:
                    correct_path = src.replace(filename, real_files[lower_filename])
                    new_content = new_content.replace(src, correct_path)
                    print(f"üñºÔ∏è  Opraven obr√°zek: {src} ‚Üí {correct_path}")
                    fixed += 1

        if new_content != content:
            html_file.write_text(new_content, encoding="utf-8")

    print(f"‚úÖ Opraveno {fixed} obr√°zk≈Ø.")

def add_favicon_and_meta():
    """P≈ôid√° favicon a z√°kladn√≠ meta tagy, pokud chyb√≠."""
    html_file = ROOT / "index.html"
    if not html_file.exists():
        print("üìÑ index.html neexistuje.")
        return

    content = html_file.read_text(encoding="utf-8")

    # Favicon
    if '<link rel="icon"' not in content:
        insert_after = '<head>'
        favicon_tag = '    <link rel="icon" type="image/png" href="images/favicon.png">\n'
        if (IMAGE_DIR / "favicon.png").exists():
            content = content.replace(insert_after, insert_after + "\n" + favicon_tag)
            print("‚úÖ P≈ôid√°n favicon tag.")

    # Meta description
    if '<meta name="description"' not in content:
        meta_desc = '    <meta name="description" content="Gem District - Exclusive NFT Art Gallery">\n'
        content = content.replace("<head>", "<head>\n" + meta_desc)
        print("‚úÖ P≈ôid√°n meta description tag.")

    # Open Graph
    if '<meta property="og:title"' not in content:
        og_tags = '''    <meta property="og:title" content="Gem District">
    <meta property="og:description" content="Exclusive NFT Art Gallery">
    <meta property="og:image" content="images/og-image.jpg">
    <meta property="og:url" content="https://gemdistrict.art">
'''
        content = content.replace("<head>", "<head>\n" + og_tags)
        print("‚úÖ P≈ôid√°ny Open Graph tagy.")

    html_file.write_text(content, encoding="utf-8")

if __name__ == "__main__":
    print("ü§ñ Spou≈°t√≠m Fix-It Bota pro gemdistrict.art...\n")
    fix_image_case()
    add_favicon_and_meta()
    print("\nüéâ Bot dokonƒçil opravy. Nezapome≈à commitnout zmƒõny!")
